<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Indicadores Integrados</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0 24px 48px;
            background-color: #f7f7f7;
        }
        header {
            background-color: #1f2933;
            color: #fff;
            padding: 24px;
            margin: 0 -24px 24px;
        }
        h1 {
            margin: 0;
        }
        section {
            background-color: #fff;
            margin-bottom: 24px;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        h2 {
            margin-top: 0;
            color: #1f2933;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        th, td {
            border: 1px solid #d1d5db;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #e5e7eb;
        }
        .kpi-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        ul {
            margin: 0;
            padding-left: 18px;
        }
    </style>
</head>
<body>
<header>
    <h1>Resumo Executivo de KPIs</h1>
    <p>Visão integrada dos indicadores de Comercial, Carteira, Compras e Planejamento.</p>
</header>

<section>
    <h2>Desempenho Comercial</h2>
    <p class="kpi-value">Valor Total de Vendas: R$ {{ comercial.valor_total_vendas|floatformat:2 }}</p>
    <p class="kpi-value">Total de Unidades Vendidas: {{ comercial.total_unidades }}</p>
    <p class="kpi-value">Ticket Médio por Venda: R$ {{ comercial.ticket_medio_venda|floatformat:2 }}</p>
    <p class="kpi-value">Ticket Médio por Unidade: R$ {{ comercial.ticket_medio_por_unidade|floatformat:2 }}</p>

    <h3>Vendas por Corretor / Empreendimento</h3>
    <table>
        <thead>
        <tr>
            <th>Corretor</th>
            <th>Empreendimento</th>
            <th>Unidades</th>
            <th>Valor (R$)</th>
        </tr>
        </thead>
        <tbody>
        {% for venda in comercial.vendas_por_corretor %}
            <tr>
                <td>{{ venda.corretor__nome }}</td>
                <td>{{ venda.empreendimento__nome }}</td>
                <td>{{ venda.total_unidades }}</td>
                <td>{{ venda.total_valor|floatformat:2 }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="4">Nenhum dado cadastrado.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</section>

<section>
    <h2>Saúde Financeira da Carteira</h2>
    <p class="kpi-value">Taxa de Inadimplência: {{ carteira.taxa_inadimplencia|floatformat:2 }}%</p>
    <p class="kpi-value">Valor Recebido: R$ {{ carteira.valor_recebido|floatformat:2 }}</p>
    <p class="kpi-value">Saldo Devedor: R$ {{ carteira.saldo_devedor|floatformat:2 }}</p>

    <h3>Inadimplência por Faixa de Atraso</h3>
    <table>
        <thead>
        <tr>
            <th>Faixa (dias)</th>
            <th>Valor em Atraso (R$)</th>
        </tr>
        </thead>
        <tbody>
        {% for faixa, valor in carteira.inadimplencia_por_faixa.items %}
            <tr>
                <td>{{ faixa }}</td>
                <td>{{ valor|floatformat:2 }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="2">Nenhum atraso registrado.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</section>

<section>
    <h2>Gestão de Custos de Compras</h2>
    <p class="kpi-value">Custo Total de Compras: R$ {{ compras.custo_total|floatformat:2 }}</p>

    <h3>Custo por Empreendimento</h3>
    <table>
        <thead>
        <tr>
            <th>Empreendimento</th>
            <th>Valor (R$)</th>
        </tr>
        </thead>
        <tbody>
        {% for item in compras.custo_por_empreendimento %}
            <tr>
                <td>{{ item.empreendimento__nome }}</td>
                <td>{{ item.total|floatformat:2 }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="2">Nenhum pedido registrado.</td></tr>
        {% endfor %}
        </tbody>
    </table>

    <h3>Participação por Fornecedor</h3>
    <table>
        <thead>
        <tr>
            <th>Fornecedor</th>
            <th>Valor (R$)</th>
            <th>Participação (%)</th>
        </tr>
        </thead>
        <tbody>
        {% for fornecedor in compras.supplier_share %}
            <tr>
                <td>{{ fornecedor.fornecedor }}</td>
                <td>{{ fornecedor.valor|floatformat:2 }}</td>
                <td>{{ fornecedor.percentual|floatformat:2 }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="3">Nenhum dado cadastrado.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</section>

<section>
    <h2>Indicadores Estratégicos</h2>
    <h3>Planejado vs. Realizado</h3>
    <table>
        <thead>
        <tr>
            <th>Empreendimento</th>
            <th>Custo Planejado (R$)</th>
            <th>Custo Real (R$)</th>
            <th>Variação (R$)</th>
        </tr>
        </thead>
        <tbody>
        {% for item in estrategicos.planejado_vs_realizado %}
            <tr>
                <td>{{ item.empreendimento__nome }}</td>
                <td>{{ item.custo_planejado|floatformat:2 }}</td>
                <td>{{ item.custo_real|floatformat:2 }}</td>
                <td>{{ item.variacao|floatformat:2 }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="4">Nenhum planejamento cadastrado.</td></tr>
        {% endfor %}
        </tbody>
    </table>

    <h3>Margem de Lucro por Empreendimento</h3>
    <table>
        <thead>
        <tr>
            <th>Empreendimento</th>
            <th>Receita (R$)</th>
            <th>Custos (R$)</th>
            <th>Margem (R$)</th>
        </tr>
        </thead>
        <tbody>
        {% for margem in estrategicos.margem_por_empreendimento %}
            <tr>
                <td>{{ margem.empreendimento }}</td>
                <td>{{ margem.vendas|floatformat:2 }}</td>
                <td>{{ margem.custos|floatformat:2 }}</td>
                <td>{{ margem.margem|floatformat:2 }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="4">Nenhuma margem calculada.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</section>
</body>
</html>
